import {Aside} from '@astrojs/starlight/components'

## NgÃ y 39 - Máº¡ng vÃ  Báº£o máº­t trong Docker

_Má»™t trong nhá»¯ng váº¥n Ä‘á» Ä‘Æ°á»£c Ä‘á» cáº­p ráº¥t nhiá»u trong cháº·ng hÃ nh trÃ¬nh cá»§a chÃºng ta chÃ­nh lÃ  Máº¡ng vÃ  Báº£o máº­t.
HÃ´m nay, chÃºng ta sáº½ nÃ³i vá» hai chá»§ Ä‘á» nÃ y trong Docker._

**_HÃ£y sáºµn sÃ ng Ä‘á»ƒ báº¯t Ä‘áº§u ngÃ y má»›i vá»›i Docker nhÃ©!_** ğŸ•

### Cáº¥u hÃ¬nh máº¡ng

```bash title="Getting the manual of docker network"

docker network
docker network ls # Liá»‡t kÃª cÃ¡c card máº¡ng

```

![network](../../../../assets/containers/network.png)

![list](../../../../assets/containers/list.png)

_Lá»‡nh ```docker network``` lÃ  lá»‡nh giÃºp chÃºng ta cÃ³ thá»ƒ thao tÃ¡c vá»›i cÃ¡c card máº¡ng trong Docker.
Má»—i card máº¡ng cÃ³ má»™t cÃ¡i tÃªn vÃ  mÃ£ Ä‘á»‹nh danh duy nháº¥t, cÅ©ng nhÆ° Ä‘Æ°á»£c liÃªn káº¿t vá»›i má»™t driver cá»¥ thá»ƒ._

```bash title="Inspecting a network"

docker network inspect bridge

```

![inspect](../../../../assets/containers/inspect.png)

_Lá»‡nh ```docker network inspect``` giÃºp chÃºng ta xem thÃ´ng tin chi tiáº¿t cá»§a má»™t card máº¡ng cá»¥ thá»ƒ. Trong vÃ­ dá»¥ trÃªn, 
ta tháº¥y Ä‘Æ°á»£c card máº¡ng bridge cÃ³ má»™t sá»‘ thÃ´ng tin nhÆ°: tÃªn, mÃ£ Ä‘á»‹nh danh, driver, máº¡ng con, cá»•ng vÃ o, ... vÃ  nÃ³ Ä‘ang 
trá» vá» driver bridge, cÃ³ Ä‘á»‹a chá»‰ lÃ  ```172.17.0.1``` - Ä‘á»‹a chá»‰ ná»™i bá»™ cá»§a mÃ¡y chá»§, Ä‘á»“ng nghÄ©a vá»›i viá»‡c chá»‰ cÃ³ thá»ƒ truy 
cáº­p trong ná»™i bá»™ mÃ¡y chá»§. Náº¿u báº¡n Ä‘á»©ng á»Ÿ trÃ¬nh duyá»‡t mÃ  gÃµ Ä‘á»‹a chá»‰ cá»§a container, **báº¡n sáº½ khÃ´ng thá»ƒ truy cáº­p Ä‘Æ°á»£c**._

#### Káº¿t ná»‘i máº¡ng giá»¯a container vá»›i Internet

_Máº·c Ä‘á»‹nh card bridge gáº¯n cho cÃ¡c container má»›i - **trá»« khi chá»‰ Ä‘á»‹nh cá»¥ thá»ƒ**. Ta cÃ³ thá»ƒ dÃ¹ng cÃ¡ch sau Ä‘á»ƒ káº¿t ná»‘i máº¡ng
tá»« container ra ngoÃ i. Má»™t thÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh Ä‘á»ƒ giÃºp chÃºng ta thao tÃ¡c vá» máº¡ng cho container nhÆ° pháº§n dÆ°á»›i._

```bash title="Creating a new container, and get into the container..."

docker run -dt ubuntu sleep infinity # Táº¡o má»™t container má»›i
docker network inspect bridge # Xem thÃ´ng tin card máº¡ng bridge
docker exec -it <container_id> bash # Truy cáº­p vÃ o container
    root@<container_id>:/# apt update && apt install iputils-ping -y ## CÃ i Ä‘áº·t gÃ³i ping
    root@<container_id>:/# ping -c4 google.com # Kiá»ƒm tra káº¿t ná»‘i máº¡ng
    root@<container_id>:/# exit # ThoÃ¡t khá»i container
docker stop <container_id> # Dá»«ng container
docker ps -a # Xem danh sÃ¡ch cÃ¡c container

```

#### Xuáº¥t cá»•ng

```bash title="Publishing a port"

# Cháº¡y má»™t container nginx, má»Ÿ cá»•ng 8080 trÃªn mÃ¡y chá»§ vÃ  chuyá»ƒn hÆ°á»›ng vÃ o cá»•ng 80 cá»§a container
docker run --name webapp1 -dt -p 8080:80 nginx 
docker ps # Kiá»ƒm tra cá»•ng Ä‘Ã£ Ä‘Æ°á»£c má»Ÿ chÆ°a
ip addr # Tá»« mÃ¡y tÃ­nh, má»Ÿ WSL2, gÃµ lá»‡nh nÃ y vÃ  tÃ¬m Ä‘á»‹a chá»‰ IP cá»§a container
 
```

![ports](../../../../assets/containers/ports.png)

_Äá»©ng á»Ÿ trÃ¬nh duyá»‡t, gÃµ Ä‘á»‹a chá»‰ IP cá»§a container vÃ  cá»•ng 8080, báº¡n sáº½ tháº¥y trang web cá»§a nginx._

![browser](../../../../assets/containers/browser.png)

### Báº£o máº­t trong Docker

**_Äiá»ƒm máº¥u chá»‘t trong báº£o máº­t Docker chÃ­nh lÃ  viá»‡c cáº¥u hÃ¬nh má»©c cÃ´ng khai vÃ  phÃ¢n quyá»n._**

#### PhÃ¢n quyá»n

_Má»—i container Ä‘á»u Ä‘Æ°á»£c cháº¡y á»Ÿ quyá»n root, Ä‘iá»u nÃ y cÃ³ thá»ƒ táº¡o ra má»™t sá»‘ váº¥n Ä‘á» vá» báº£o máº­t. Äá»ƒ báº£o máº­t, trong
tá»‡p cáº¥u hÃ¬nh Docker (Dockerfile), ta cÃ³ thá»ƒ thÃªm má»™t sá»‘ lá»‡nh Ä‘á»ƒ giáº£m quyá»n root._

```bash title="Adding a user to a container"

FROM ubuntu:latest
RUN apt update && apt install upgrade -y
RUN groupadd -g 1000 appuser && useradd -r -u 1000 -g appuser appuser
USER appuser

```

<Aside title="LÆ°u Ã½" type="caution">

**_Ta cÃ³ thá»ƒ cháº¡y lá»‡nh báº±ng cÃ¡ch sau - tuy nhiÃªn cÃ¡ch nÃ y cÃ³ thá»ƒ khÃ´ng giáº£i quyáº¿t lá»— há»•ng báº£o máº­t tiá»m áº©n cá»§a chÃ­nh
báº£n áº£nh Ä‘Ã³._**

```bash title="Running a container with a normal user"

docker run -dt --name webapp2 --user 1009 nginx

```
</Aside>

#### Má»©c cÃ´ng khai

_CÃ¡c kho lÆ°u trá»¯ báº£n áº£nh cÃ´ng khai (Registry) nhÆ° Docker Hub, GitHub, ... Ä‘á»u cÃ³ thá»ƒ chá»©a cÃ¡c báº£n áº£nh khÃ´ng an toÃ n.
Äá»ƒ báº£o máº­t, ta cÃ³ thá»ƒ táº¡o má»™t báº£n áº£nh riÃªng, hoáº·c kiá»ƒm tra báº£n áº£nh trÆ°á»›c khi sá»­ dá»¥ng. Äiá»u nÃ y giÃºp kiá»ƒm soÃ¡t hoÃ n
toÃ n cÃ¡c báº£n áº£nh mÃ  chÃºng ta sá»­ dá»¥ng._

### CÃ¡ch máº¡ng vá» tinh gá»n bá»™ mÃ¡y

_Náº¿u chÃºng ta cháº¡y cÃ¢u lá»‡nh sau, chÃºng ta cÃ³ thá»ƒ biáº¿t Ä‘Æ°á»£c kÃ­ch thÆ°á»›c cá»§a báº£n áº£nh, tá»« Ä‘Ã³ cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a dung lÆ°á»£ng
lÆ°u trá»¯ cá»§a mÃ¡y chá»§._

```bash title="Checking the size of an image"

docker images

```

<Aside title="Máº¹o váº·t" type="tip">

- _**Äá»«ng bao giá» sá»­ dá»¥ng tag ```latest``` cho báº£n áº£nh cá»§a mÃ¬nh**. Äiá»u nÃ y giÃºp chÃºng ta kiá»ƒm soÃ¡t Ä‘Æ°á»£c phiÃªn báº£n cá»§a 
báº£n áº£nh mÃ  chÃºng ta sá»­ dá»¥ng, trÃ¡nh viá»‡c sá»­ dá»¥ng báº£n áº£nh khÃ´ng an toÃ n._
- _ThÃ´ng thÆ°á»ng, cÃ¡c báº£n áº£nh ```alpine``` sáº½ cÃ³ **kÃ­ch thÆ°á»›c nhá» hÆ¡n** so vá»›i cÃ¡c báº£n áº£nh khÃ¡c. Äiá»u nÃ y giÃºp chÃºng ta 
giáº£m dung lÆ°á»£ng lÆ°u trá»¯ cá»§a mÃ¡y chá»§._

</Aside>

_Táº¥t nhiÃªn, sá»­ dá»¥ng Docker tÆ°á»Ÿng lÃ  Ä‘Æ¡n giáº£n nhÆ°ng thá»±c cháº¥t khÃ´ng há» Ä‘Æ¡n giáº£n nhÆ° váº­y. ChÃºng ta sáº½ cÃ³ ráº¥t nhiá»u lá»±a chá»n
khÃ¡c nhau thay tháº¿ cho Docker trong phÃ¡t triá»ƒn container. QuÃ½ vá»‹ cÃ³ thá»ƒ theo dÃµi nhá»¯ng lá»±a chá»n trong bÃ i viáº¿t 
[nÃ y](https://www.builetuananh.name.vn/2024-01/) Ä‘á»ƒ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan nháº¥t vá» container._