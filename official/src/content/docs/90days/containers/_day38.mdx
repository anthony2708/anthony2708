import { Steps, Aside } from '@astrojs/starlight/components';

## NgÃ y 38 - DÃ¡ng hÃ¬nh cá»§a Docker ğŸ–¼

_Xin chÃ o, cuá»‘i cÃ¹ng thÃ¬ chÃºng ta cÅ©ng Ä‘Ã£ sáºµn sÃ ng cho ngÃ y tiáº¿p theo cá»§a hÃ nh trÃ¬nh Ä‘áº§y chÃ´ng gai nÃ y. HÃ´m nay chÃºng ta 
sáº½ tÃ¬m hiá»ƒu vá» Docker image, báº£n áº£nh cá»§a Docker, vÃ  cÃ¡ch táº¡o ra má»™t báº£n áº£nh tá»« má»™t Dockerfile._

**_Náº¿u báº¡n Ä‘Ã£ Ä‘Ã³ng gÃ³i Ä‘áº§y Ä‘á»§ tÆ° trang, hÃ£y cÃ¹ng nhau báº¯t Ä‘áº§u hÃ nh trÃ¬nh má»›i nÃ y nhÃ©!_** ğŸš‹

### Khá»Ÿi Ä‘á»™ng

_Sau khi cÃ i Ä‘áº·t Docker, chÃºng ta sáº½ báº¯t Ä‘áº§u báº±ng viá»‡c cháº¡y cÃ¢u lá»‡nh sau._

```bash title="Running a container"

docker run -d -p 80:80 docker/getting-started

```

**_Khi cÃ¡c báº¡n cháº¡y lá»‡nh nÃ y, nhá»¯ng viá»‡c sau Ä‘Ã¢y sáº½ xáº£y ra._**

<Steps>
1. _Docker sáº½ tÃ¬m kiáº¿m image `docker/getting-started` trÃªn mÃ¡y tÃ­nh cá»§a báº¡n. Náº¿u khÃ´ng tÃ¬m tháº¥y, Docker sáº½ **táº£i image** 
nÃ y tá»« DockerHub hoáº·c báº¥t ká»³ registry lÆ°u trá»¯ nÃ o cÃ³ báº£n áº£nh nÃ y. Viá»‡c nÃ y cÅ©ng sáº½ diá»…n ra tÆ°Æ¡ng tá»± vá»›i cÃ¡c báº£n áº£nh khÃ¡c._
2. _Docker sáº½ táº¡o má»™t container tá»« image nÃ y. Trong trÆ°á»ng há»£p nÃ y, container sáº½ cháº¡y má»™t á»©ng dá»¥ng web trÃªn cá»•ng 80._
3. _Docker sáº½ **chuyá»ƒn tiáº¿p** cá»•ng 80 cá»§a mÃ¡y tÃ­nh cá»§a báº¡n tá»›i cá»•ng 80 cá»§a container (```-p``` - port)._
4. _Viá»‡c cháº¡y container nÃ y sáº½ diá»…n ra á»Ÿ **cháº¿ Ä‘á»™ ná»n** (background mode) (```-d``` - detach)._
5. _Káº¿t quáº£ cuá»‘i cÃ¹ng, báº¡n sáº½ cÃ³ má»™t á»©ng dá»¥ng hoÃ n chá»‰nh, khi truy cáº­p vÃ o `http://localhost/tutorial` trÃªn trÃ¬nh duyá»‡t._
</Steps>

![tutorial](../../../../assets/containers/tutorial.png)

_Äá»‘i vá»›i cÃ¡c báº£n áº£nh, chÃºng ta cÃ³ thá»ƒ phÃ¢n loáº¡i lÃ m ba nhÃ³m nhÆ° sau._

- _**Official Image**: LÃ  nhá»¯ng báº£n áº£nh Ä‘Æ°á»£c Docker cung cáº¥p, chÃºng ta cÃ³ thá»ƒ tÃ¬m tháº¥y trÃªn 
[DockerHub](https://hub.docker.com/)._
- _**Verified Publisher**: LÃ  nhá»¯ng báº£n áº£nh Ä‘Æ°á»£c xÃ¡c thá»±c bá»Ÿi Docker, cung cáº¥p bá»Ÿi cÃ¡c nhÃ  cung cáº¥p pháº§n má»m._
- _**User-defined images**: LÃ  nhá»¯ng báº£n áº£nh Ä‘Æ°á»£c táº¡o ra bá»Ÿi ngÆ°á»i dÃ¹ng vÃ  Ä‘Äƒng táº£i trÃªn DockerHub hoáº·c cÃ¡c 
registry khÃ¡c._

![image](../../../../assets/containers/image.png)

_Äá»ƒ dá»«ng container Ä‘ang cháº¡y, cáº§n pháº£i xÃ¡c Ä‘á»‹nh `container ID` hoáº·c `container name` vÃ  cháº¡y lá»‡nh sau._

```bash title="Stopping a container"

docker ps
docker stop <container ID or container name>

```

### Tham vá»ng to lá»›n vá»›i cáº£ má»™t há»‡ Ä‘iá»u hÃ nh...

```bash title="Running a container with OS"

docker run -it ubuntu bash

```
_Khi báº¡n cháº¡y lá»‡nh nÃ y, ngay láº­p tá»©c báº¡n cÃ³ má»™t báº£n áº£nh cá»§a Ubuntu trÃªn Docker vá»›i Bash._

_**Báº¡n cÃ³ tin Ä‘Æ°á»£c khÃ´ng, nhÆ°ng Ä‘Ã³ lÃ  sá»± tháº­t**. Khi báº¡n cháº¡y xong lá»‡nh trÃªn, báº¡n sáº½ tháº¥y má»™t dáº¥u nháº¯c má»›i, Ä‘Ã³ chÃ­nh lÃ 
má»™t cá»­a sá»• dÃ²ng lá»‡nh cá»§a Ubuntu. Táº¥t nhiÃªn Ubuntu trÃªn Docker chá»‰ **cá»¡ Ä‘Ã¢u Ä‘Ã³ 30MB** thÃ´i, nhÆ°ng táº¥t nhiÃªn lÃ  báº¡n cÃ³ 
thá»ƒ thÃªm cÃ¡c gÃ³i pháº§n má»m khÃ¡c vÃ o báº£n áº£nh nÃ y._

![ubuntu](../../../../assets/containers/ubuntu.png)

![apt](../../../../assets/containers/apt.png)

### TÃ¬m hiá»ƒu vá» Dockerfile

_Dockerfile lÃ  má»™t táº­p tin vÄƒn báº£n chá»©a má»™t loáº¡t cÃ¡c hÆ°á»›ng dáº«n Ä‘á»ƒ táº¡o ra má»™t báº£n áº£nh. Má»—i hÆ°á»›ng dáº«n trong Dockerfile
thÆ°á»ng Ä‘Æ°á»£c tá»• chá»©c theo dáº¡ng má»™t **"lá»›p" (layer)** vÃ  má»—i lá»›p nÃ y sáº½ táº¡o ra má»™t image má»›i._

_Cáº¥u trÃºc cá»§a cÃ¡c lá»›p, sáº½ Ä‘i theo phÆ°Æ¡ng thá»©c **xáº¿p chá»“ng (stacked)** vÃ  má»—i lá»›p sáº½ káº¿ thá»«a tá»« lá»›p trÆ°á»›c Ä‘Ã³._

![layers](../../../../assets/containers/layers.png)

_Theo thá»© tá»±, chÃºng ta sáº½ cÃ³ **Dockerfile dá»±ng thÃ nh image**, vÃ  c**ontainer thÃ¬ cháº¡y tá»« image Ä‘Ã³**. Má»—i báº£n áº£nh sáº½ cÃ²n 
cÃ³ manifest. Manifest trong tiáº¿ng Anh cÃ³ nghÄ©a lÃ  "báº£n thá»ƒ", vÃ  nÃ³ chá»©a thÃ´ng tin vá» cÃ¡c lá»›p, cáº¥u trÃºc, vÃ  metadata cá»§a
báº£n áº£nh._

#### VÃ­ dá»¥ vá» Dockerfile

```bash title="Dockerfile"

FROM node:18-alpine
WORKDIR /app/
COPY ./sources/ .
RUN npm install
EXPOSE 3000
CMD ["npm", "start"]

```

**_DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ tá»« khÃ³a hiá»‡u lá»‡nh cá»§a Dockerfile mÃ  báº¡n sáº½ thÆ°á»ng xuyÃªn gáº·p._**

|    Lá»‡nh          |                                        Má»¥c Ä‘Ã­ch                                      |
|:----------------:|:------------------------------------------------------------------------------------:|
| ```FROM```       | _Äá»ƒ chá»‰ Ä‘á»‹nh báº£n áº£nh gá»‘c._                                                           |
| ```WORKDIR```    | _Äá»ƒ Ä‘áº·t thÆ° má»¥c lÃ m viá»‡c cho báº¥t ká»³ lá»‡nh nÃ o phÃ­a sau trong Dockerfile._             |
| ```RUN```        | _Äá»ƒ cháº¡y lá»‡nh giÃºp cÃ i Ä‘áº·t báº¥t ká»³ á»©ng dá»¥ng vÃ  gÃ³i phá»¥ trá»£ cáº§n thiáº¿t cho container._  |
| ```COPY```       | _Äá»ƒ sao chÃ©p cÃ¡c tá»‡p hoáº·c thÆ° má»¥c tá»« má»™t vá»‹ trÃ­ cá»¥ thá»ƒ._                             |
| ```ADD```        | _LÃ  COPY, nhÆ°ng cÅ©ng cÃ³ thá»ƒ xá»­ lÃ½ cÃ¡c URL vÃ  giáº£i nÃ©n cÃ¡c tá»‡p nÃ©n._                  |
| ```ENTRYPOINT``` | _Lá»‡nh sáº½ thá»±c thi khi container khá»Ÿi Ä‘á»™ng. Máº·c Ä‘á»‹nh lÃ  ```/bin/sh -c```_             |
| ```CMD```        | _CÃ¡c Ä‘á»‘i sá»‘ truyá»n vÃ o. Náº¿u ENTRYPOINT máº·c Ä‘á»‹nh, CMD lÃ  lá»‡nh thá»±c thi._              |
| ```EXPOSE```     | _Äá»ƒ xÃ¡c Ä‘á»‹nh cá»•ng truy cáº­p á»©ng dá»¥ng container._                                      |
| ```LABEL```      | _Äá»ƒ thÃªm metadata vÃ o báº£n áº£nh._                                                      |

_Dá»±a trÃªn Dockerfile phÃ­a trÃªn ta sáº½ cÃ³ nhá»¯ng bÆ°á»›c sau._

<Steps>

1. _Láº¥y báº£n áº£nh gá»‘c (base image) tá»« `node:18-alpine`, tá»©c lÃ  má»™t báº£n áº£nh cá»§a Node.js trÃªn Alpine Linux._
2. _Äáº·t thÆ° má»¥c lÃ m viá»‡c cho container lÃ  `/app/`._
3. _Sao chÃ©p táº¥t cáº£ cÃ¡c tá»‡p tá»« thÆ° má»¥c `./sources/` vÃ o thÆ° má»¥c lÃ m viá»‡c cá»§a container._
4. _CÃ i Ä‘áº·t cÃ¡c gÃ³i phá»¥ trá»£ cáº§n thiáº¿t cho á»©ng dá»¥ng Node.js._
5. _Má»Ÿ cá»•ng 3000 Ä‘á»ƒ truy cáº­p á»©ng dá»¥ng._
6. _Cháº¡y á»©ng dá»¥ng Node.js báº±ng lá»‡nh `npm start`._

</Steps>

_LÃºc nÃ y, ta cÃ³ thá»ƒ truy cáº­p á»©ng dá»¥ng Node.js thÃ´ng qua cá»•ng 3000 cá»§a mÃ¡y tÃ­nh 
(Ä‘Ãºng hÆ¡n lÃ  ```http://localhost:3000```)._

#### Dá»±ng Dockerfile
Cháº¡y cÃ¢u lá»‡nh sau Ä‘á»ƒ dá»±ng Dockerfile nÃ y thÃ nh báº£n áº£nh má»›i.

```bash title="Building a Dockerfile"

docker build -t my-node-app:1.0 .
# -t: tag cho báº£n áº£nh
# .: thÆ° má»¥c chá»©a Dockerfile

```

**_VÃ  Ä‘Ã³ lÃ  cÃ¡ch báº¡n cÃ³ má»™t báº£n áº£nh má»›i toanh, tá»± dá»±ng tá»« má»™t Dockerfile._** ğŸ‰

<Aside type="tip" title="ChÆ°a dá»«ng láº¡i á»Ÿ Ä‘Ã³...">

**_Náº¿u báº¡n nghÄ© chá»‰ má»™t Dockerfile lÃ  Ä‘á»§, thÃ¬ báº¡n Ä‘Ã£ láº§m to._**

_Náº¿u báº¡n nghÄ© ráº±ng viá»‡c chá»‰ cÃ³ má»™t Dockerfile lÃ  quÃ¡ Ä‘Æ¡n giáº£n, thÃ¬ báº¡n hoÃ n toÃ n cÃ³ thá»ƒ táº¡o ra má»™t cá»¥m cÃ¡c container.
Vá»›i Docker Compose, báº¡n cÃ³ thá»ƒ táº¡o ra má»™t táº­p há»£p cÃ¡c container, cÃ¹ng cháº¡y má»™t á»©ng dá»¥ng lá»›n._

**_ChÃºng ta sáº½ cÃ²n gáº·p láº¡i nhau trong ngÃ y mai, vá»›i nhiá»u Ä‘iá»u thÃº vá»‹ hÆ¡n ná»¯a vá» Compose. Byebye!!!_** ğŸš€

</Aside>